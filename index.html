<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ğŸ¥• Greedy Cat â€“ Smart Veg System</title>

<style>
body{background:#0f0f0f;color:#fff;font-family:Tahoma;text-align:center;margin:0}
h1{margin:10px}
.box{background:#1a1a1a;border-radius:14px;padding:12px;margin:10px auto;max-width:440px}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.item{font-size:26px;padding:10px;border-radius:12px;background:#222;cursor:pointer}
.item.hot{outline:2px solid orange}
.bar{display:flex;flex-direction:row-reverse;gap:6px;overflow-x:auto;padding:6px}
.round{background:#333;padding:4px 6px;border-radius:8px;display:flex;gap:4px;cursor:pointer}
.num{font-size:10px;color:#aaa}
.mode{padding:6px 10px;border-radius:10px;background:#333;margin:4px;cursor:pointer}
.mode.active{background:#ff9800;color:#000}
.green{color:#4caf50}
.red{color:#ff5252}
.orange{color:#ff9800}
.small{font-size:13px;color:#bbb}
.percent{font-size:13px}
</style>
</head>

<body>

<h1>ğŸ¥• Greedy Cat â€“ Smart Veg</h1>

<div class="box">
<b>ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨</b><br>
<span class="mode active" onclick="setMode(1)">ğŸŸ¢ Ø¢Ù…Ù†</span>
<span class="mode" onclick="setMode(2)">ğŸŸ¡ Ù…ØªÙˆØ§Ø²Ù†</span>
<span class="mode" onclick="setMode(3)">ğŸŸ  ØªÙƒØ±Ø§Ø±</span>
<span class="mode" onclick="setMode(4)">ğŸ”´ ÙØ®</span>
</div>

<div class="box">
<div class="grid" id="items"></div>
<div class="small">Ø¶ØºØ· = ØªØ³Ø¬ÙŠÙ„ | Ø¶ØºØ· Ù…Ø·ÙˆÙ‘Ù„ = HOT</div>
</div>

<div class="box">
<b>Ø¢Ø®Ø± 20 Ø¯ÙˆØ±</b>
<div class="bar" id="bar"></div>
</div>

<div class="box">
<b>ğŸ”® Ø§Ù„ØªÙˆÙ‚Ø¹</b>
<div id="prediction"></div>
<div id="note" class="small"></div>
</div>

<script>
const veggies=["ğŸ¥•","ğŸŒ½","ğŸ…","ğŸŒ¶ï¸"];
const meats=[
 {i:"ğŸ¦",mult:10},
 {i:"ğŸ„",mult:15},
 {i:"ğŸŸ",mult:25},
 {i:"ğŸ”",mult:45}
];
const all=[...veggies,...meats.map(m=>m.i)];

let history=[], hot={}, mode=1;

const itemsDiv=document.getElementById("items");
const barDiv=document.getElementById("bar");
const predDiv=document.getElementById("prediction");
const noteDiv=document.getElementById("note");

/* Ø±Ø³Ù… Ø§Ù„Ø£ØµÙ†Ø§Ù */
all.forEach(i=>{
 const d=document.createElement("div");
 d.className="item";
 d.textContent=i;
 let t;
 d.onclick=()=>{history.push(i);render()};
 d.onmousedown=()=>{t=setTimeout(()=>{hot[i]=!hot[i];render()},600)};
 d.onmouseup=()=>clearTimeout(t);
 itemsDiv.appendChild(d);
});

function setMode(m){
 mode=m;
 document.querySelectorAll(".mode").forEach(x=>x.classList.remove("active"));
 event.target.classList.add("active");
 render();
}

/* Ø­Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø± */
function repeatStatus(i){
 const c=history.slice(-3).filter(x=>x===i).length;
 if(c>=3) return "block";
 if(c==2) return "high";
 if(c==1) return "maybe";
 return "safe";
}

/* Ø³ÙƒÙˆØ±Ø§Øª */
function vegScore(i){
 if(repeatStatus(i)=="block") return -999;
 let miss=history.lastIndexOf(i);
 miss=miss==-1?20:history.length-miss-1;
 let bonus=repeatStatus(i)=="maybe"?2:0;
 return Math.min(miss,14)+bonus+(hot[i]?2:0);
}
function meatScore(m){
 if(repeatStatus(m.i)=="block") return -999;
 let miss=history.lastIndexOf(m.i);
 miss=miss==-1?8:history.length-miss-1;
 return Math.min(miss,6)-(m.mult/4);
}

function render(){
 /* Ø§Ù„Ø´Ø±ÙŠØ· */
 barDiv.innerHTML="";
 const start=Math.max(0,history.length-20);
 history.slice(-20).forEach((it,idx)=>{
  const r=document.createElement("div");
  r.className="round";
  r.onclick=()=>{history.splice(start+idx,1);render()};
  r.innerHTML=`<span class="num">${start+idx+1}</span><span>${it}</span>`;
  barDiv.appendChild(r);
 });

 /* Ø§Ù„ØªÙˆÙ‚Ø¹ Ø­Ø³Ø¨ Ø§Ù„ÙˆØ¶Ø¹ */
 let picks=[];
 const vRank=veggies.map(i=>({i,s:vegScore(i)})).sort((a,b)=>b.s-a.s);
 const mRank=meats.map(m=>({i:m.i,s:meatScore(m)})).sort((a,b)=>b.s-a.s);

 if(mode==1){picks=[...vRank.slice(0,3)]; noteDiv.textContent="ğŸŸ¢ Ø®Ø¶Ø§Ø± ÙÙ‚Ø· (Ø¢Ù…Ù†)";}
 if(mode==2){picks=[...vRank.slice(0,3),mRank[0]]; noteDiv.textContent="ğŸŸ¡ Ù„Ø­Ù… Ø¶Ø¹ÙŠÙ Ø§Ø­ØªÙŠØ§Ø·ÙŠ";}
 if(mode==3){picks=[...vRank.slice(0,3)]; noteDiv.textContent="ğŸŸ  Ø§Ù„ØªÙƒØ±Ø§Ø± Ù…Ø­Ø³ÙˆØ¨";}
 if(mode==4){picks=[...vRank.slice(0,2),mRank[0]]; noteDiv.textContent="ğŸ”´ Ù„Ø­Ù… = ØªØ­Ø°ÙŠØ±";}

 const sum=picks.reduce((a,b)=>a+Math.max(b.s,0),0)||1;
 predDiv.innerHTML=picks.map(p=>{
  const cls=veggies.includes(p.i)?"green":"red";
  const tag=repeatStatus(p.i)=="maybe"?" ğŸ”":"";
  return `<span class="${cls}">${p.i}${tag} ${(Math.max(p.s,0)/sum*100).toFixed(1)}%</span>`;
 }).join(" ");

 document.querySelectorAll(".item").forEach(d=>{
  d.classList.toggle("hot",hot[d.textContent]);
 });
}
render();
</script>

</body>
</html>
