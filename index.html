<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ğŸ¥• Greedy Cat â€“ Veggie First + Repeat</title>

<style>
body{background:#0f0f0f;color:#fff;font-family:Tahoma,Arial;text-align:center;margin:0}
h1{margin:10px 0}
.box{background:#1a1a1a;border-radius:14px;padding:12px;margin:10px auto;max-width:440px}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.item{font-size:26px;padding:10px;border-radius:12px;background:#222;cursor:pointer;user-select:none}
.item.hot{outline:2px solid orange}
.bar{display:flex;flex-direction:row-reverse;gap:6px;overflow-x:auto;padding:6px}
.round{background:#333;padding:4px 6px;border-radius:8px;font-size:16px;display:flex;gap:4px;cursor:pointer}
.num{font-size:10px;color:#aaa}
.green{color:#4caf50}
.red{color:#ff5252}
.orange{color:#ff9800}
.small{font-size:13px;color:#bbb}
.percent{font-size:13px}
</style>
</head>

<body>

<h1>ğŸ¥• Greedy Cat â€“ Veggie First</h1>

<div class="box">
<b>Ø§Ù„Ø£ØµÙ†Ø§Ù</b>
<div class="grid" id="items"></div>
<div class="small">Ø¶ØºØ· = ØªØ³Ø¬ÙŠÙ„ | Ø¶ØºØ· Ù…Ø·ÙˆÙ‘Ù„ = HOT</div>
</div>

<div class="box">
<b>Ø¢Ø®Ø± 20 Ø¯ÙˆØ±</b>
<div class="bar" id="bar"></div>
</div>

<div class="box">
<b>ğŸ”® Ø§Ù„ØªÙˆÙ‚Ø¹ (Ù…Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±)</b>
<div id="prediction"></div>
<div id="note" class="small"></div>
</div>

<script>
/* ===== Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===== */
const veggies = ["ğŸ¥•","ğŸŒ½","ğŸ…","ğŸŒ¶ï¸"];
const meats = [
  { i:"ğŸ¦", mult:10 },
  { i:"ğŸ„", mult:15 },
  { i:"ğŸŸ", mult:25 },
  { i:"ğŸ”", mult:45 }
];
const all = [...veggies, ...meats.map(m=>m.i)];

let history = [];
let hot = {};

/* ===== DOM ===== */
const itemsDiv = document.getElementById("items");
const barDiv = document.getElementById("bar");
const predDiv = document.getElementById("prediction");
const noteDiv = document.getElementById("note");

/* ===== Ø±Ø³Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± ===== */
all.forEach(i=>{
  const d=document.createElement("div");
  d.className="item";
  d.textContent=i;
  let t;
  d.onclick=()=>{ history.push(i); render(); };
  d.onmousedown=()=>{ t=setTimeout(()=>{ hot[i]=!hot[i]; render(); },600); };
  d.onmouseup=()=>clearTimeout(t);
  itemsDiv.appendChild(d);
});

/* ===== Ø­Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø± ===== */
function repeatStatus(i){
  const last3 = history.slice(-3);
  const c = last3.filter(x=>x===i).length;
  if(c>=3) return {level:"block", text:"â›” Ø¬Ø¹ÙÙ„Ø©"};
  if(c===2) return {level:"high", text:"âš ï¸ ØªÙƒØ±Ø§Ø± Ø¹Ø§Ù„ÙŠ"};
  if(c===1) return {level:"maybe", text:"ğŸ” Ù…Ù…ÙƒÙ† ÙŠØªÙƒØ±Ø±"};
  return {level:"safe", text:""};
}

/* ===== Ø³ÙƒÙ‘ÙˆØ± Ø§Ù„Ø®Ø¶Ø§Ø± ===== */
function vegScore(i){
  const last = history.lastIndexOf(i);
  const miss = last===-1 ? 20 : history.length-last-1;
  const rs = repeatStatus(i);
  let repeatAdj = 0;
  if(rs.level==="maybe") repeatAdj = 2;     // Ù†Ø´Ø¬Ù‘Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
  if(rs.level==="high") repeatAdj = -2;     // Ù†Ù‡Ø¯ÙŠ
  if(rs.level==="block") return -999;       // Ù†Ù…Ù†Ø¹
  return Math.min(miss,14) + repeatAdj + (hot[i]?2:0);
}

/* ===== Ø³ÙƒÙ‘ÙˆØ± Ø§Ù„Ù„Ø­ÙˆÙ… (Ø¶Ø¹ÙŠÙ + ØªÙƒØ±Ø§Ø± Ù…Ø­Ø¯ÙˆØ¯) ===== */
function meatScore(obj){
  const i=obj.i;
  const last = history.lastIndexOf(i);
  const miss = last===-1 ? 8 : history.length-last-1;
  const rs = repeatStatus(i);
  if(rs.level==="block") return -999;
  const rarityPenalty = obj.mult / 4;
  let repeatAdj = (rs.level==="maybe") ? -1 : (rs.level==="high" ? -4 : 0);
  return Math.min(miss,6) - rarityPenalty + repeatAdj;
}

/* ===== Ø±Ø³Ù… Ø§Ù„ØµÙØ­Ø© ===== */
function render(){
  /* Ø§Ù„Ø´Ø±ÙŠØ· */
  barDiv.innerHTML="";
  const start=Math.max(0,history.length-20);
  history.slice(-20).forEach((it,idx)=>{
    const r=document.createElement("div");
    r.className="round";
    r.onclick=()=>{ history.splice(start+idx,1); render(); };
    r.innerHTML=`<span class="num">${start+idx+1}</span><span>${it}</span>`;
    barDiv.appendChild(r);
  });

  /* Ø§Ù„ØªÙˆÙ‚Ø¹ */
  const vegRank = veggies.map(i=>({i,s:vegScore(i),rs:repeatStatus(i)}))
                         .sort((a,b)=>b.s-a.s);
  const meatRank = meats.map(m=>({i:m.i,s:meatScore(m),rs:repeatStatus(m.i)}))
                         .sort((a,b)=>b.s-a.s);

  const picks = [...vegRank.slice(0,3), ...meatRank.slice(0,2)];
  const sum = picks.reduce((a,b)=>a+Math.max(b.s,0),0) || 1;

  predDiv.innerHTML = picks.map(p=>{
    const isVeg = veggies.includes(p.i);
    const cls = isVeg ? "green" : "red";
    const pct = ((Math.max(p.s,0)/sum)*100).toFixed(1);
    const tag =
      p.rs.level==="maybe" ? `<span class="orange">ğŸ”</span>` :
      p.rs.level==="high" ? `<span class="orange">âš ï¸</span>` : "";
    return `<span class="${cls}">${p.i} ${tag} <span class="percent">${pct}%</span></span>`;
  }).join(" ");

  noteDiv.innerHTML =
    "ğŸ” = Ù…Ù…ÙƒÙ† ÙŠØªÙƒØ±Ø± &nbsp;|&nbsp; âš ï¸ = ØªÙƒØ±Ø§Ø± Ø¹Ø§Ù„ÙŠ &nbsp;|&nbsp; â›” = Ø¬Ø¹ÙÙ„Ø© (Ù…Ù…Ù†ÙˆØ¹)";

  /* HOT UI */
  document.querySelectorAll(".item").forEach(d=>{
    d.classList.toggle("hot", hot[d.textContent]);
  });
}

render();
</script>

</body>
</html>
