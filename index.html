<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Greedy Cat MAX â€“ Final</title>
<style>
body{
  background:#0f0f0f;color:#fff;font-family:Tahoma;
  direction:rtl;text-align:center;margin:0;padding:10px
}
h1{margin:10px 0}
.card{
  background:#1a1a1a;border-radius:16px;
  padding:12px;margin:10px auto;max-width:420px
}
.grid{
  display:grid;grid-template-columns:repeat(4,1fr);gap:8px
}
.item{
  padding:10px;border-radius:12px;
  background:#222;font-size:26px;
  cursor:pointer;user-select:none
}
.item.hot{outline:3px solid orange}
.mode button{
  margin:4px;padding:6px 10px;
  border-radius:10px;border:0;
  background:#333;color:#fff
}
.mode button.active{background:#ffb300;color:#000}
.bar{
  display:flex;overflow-x:auto;gap:6px
}
.bar span{
  background:#333;border-radius:8px;
  padding:6px 8px;font-size:22px;white-space:nowrap
}
.small{font-size:14px;color:#aaa}
.percent span{margin:0 6px}
.warn{color:#ffb300}
</style>
</head>
<body>

<h1>ğŸ± Greedy Cat MAX</h1>

<div class="card mode">
  <div class="small">ÙˆØ¶Ø¹ Ø§Ù„ØªÙˆÙ‚Ø¹</div>
  <button onclick="setMode('3v1')">3+1</button>
  <button onclick="setMode('3v2')">3+2</button>
  <button onclick="setMode('3v3')">3+3</button>
  <button onclick="setMode('reserve5')">Ø§Ø­ØªÙŠØ§Ø·ÙŠ 5</button>
</div>

<div class="card">
  <div class="grid" id="items"></div>
  <div class="small">Ø¶ØºØ· = ØªØ³Ø¬ÙŠÙ„ | Ø¶ØºØ· Ù…Ø·ÙˆÙ‘Ù„ = HOT</div>
</div>

<div class="card">
  <div>Ø¢Ø®Ø± 20 Ø¯ÙˆØ±</div>
  <div class="bar" id="bar"></div>
</div>

<div class="card">
  <div>â³ Ø§Ù„ØºØ§ÙŠØ¨</div>
  <div id="missing"></div>
</div>

<div class="card percent">
  <div>ğŸ”® Ø§Ù„ØªÙˆÙ‚Ø¹ (%)</div>
  <div id="percent"></div>
</div>

<button onclick="resetAll()">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>

<script>
const veg=['ğŸŒ¶ï¸','ğŸ…','ğŸŒ½','ğŸ¥•'];
const meat=['ğŸ”','ğŸŸ','ğŸ®','ğŸ¦'];

const all=[...veg,...meat];

const weight={
 'ğŸŒ¶ï¸':1,'ğŸ…':1,'ğŸŒ½':1,'ğŸ¥•':1,
 'ğŸ”':0.3,'ğŸŸ':0.4,'ğŸ®':0.15,'ğŸ¦':0.25
};

let history=[];
let hot=new Set();
let mode='3v1';

const itemsDiv=document.getElementById('items');

all.forEach(x=>{
  let d=document.createElement('div');
  d.className='item';
  d.innerText=x;
  d.onclick=()=>add(x);
  d.oncontextmenu=e=>{
    e.preventDefault();
    hot.has(x)?hot.delete(x):hot.add(x);
    render();
  };
  itemsDiv.appendChild(d);
});

function setMode(m){
  mode=m;
  document.querySelectorAll('.mode button')
    .forEach(b=>b.classList.remove('active'));
  [...document.querySelectorAll('.mode button')]
    .find(b=>b.innerText.includes(m.split('v')[0]))?.classList.add('active');
  calc();
}

function add(x){
  history.push(x);
  if(history.length>200)history.shift();
  render();
  calc();
}

function render(){
  document.querySelectorAll('.item').forEach(i=>{
    hot.has(i.innerText)?i.classList.add('hot'):i.classList.remove('hot');
  });

  const bar=document.getElementById('bar');
  bar.innerHTML='';
  history.slice(-20).forEach((x,i)=>{
    bar.innerHTML+=`<span>${i+1}:${x}</span>`;
  });

  let miss='';
  all.forEach(x=>{
    let i=history.lastIndexOf(x);
    let g=i===-1?history.length:history.length-i-1;
    miss+=`${x} ØºØ§ÙŠØ¨ ${g} Ø¯ÙˆØ±<br>`;
  });
  document.getElementById('missing').innerHTML=miss;
}

function meatSignal(){
  let last=history.slice(-6);
  let mc=last.filter(x=>meat.includes(x)).length;
  let hotMeat=[...hot].some(x=>meat.includes(x));
  let missMeat=meat.some(x=>{
    let i=history.lastIndexOf(x);
    let g=i===-1?history.length:history.length-i-1;
    return g>=8;
  });
  return mc>=2||hotMeat||missMeat;
}

function pick(arr,n){
  return [...arr]
    .sort((a,b)=>(weight[b]+(hot.has(b)?0.3:0))-(weight[a]+(hot.has(a)?0.3:0)))
    .slice(0,n);
}

function calc(){
  let res=[];
  if(mode==='3v1')res=[...pick(veg,3),...pick(meat,1)];
  if(mode==='3v2')res=[...pick(veg,3),...pick(meat,2)];
  if(mode==='3v3')res=[...pick(veg,3),...pick(meat,3)];
  if(mode==='reserve5'){
    if(meatSignal())res=[...pick(meat,4),...pick(veg,2)];
    else res=[...pick(veg,4),...pick(meat,2)];
  }

  let sum=0;
  let p={};
  all.forEach(x=>{
    let v=(weight[x]||0)+(hot.has(x)?0.3:0)+(res.includes(x)?0.2:0);
    p[x]=v;sum+=v;
  });

  let out='';
  Object.keys(p).forEach(x=>{
    out+=`<span>${x} ${(p[x]/sum*100).toFixed(1)}%</span>`;
  });
  document.getElementById('percent').innerHTML=out;
}

function resetAll(){
  history=[];hot.clear();
  render();calc();
}

render();calc();
</script>
</body>
</html>
