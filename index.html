<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ğŸ˜º Greedy Cat MAX</title>

<style>
body{
  background:#0f0f0f;color:#fff;
  font-family:Tahoma,Arial;
  direction:rtl;text-align:center;
}
h1{margin:10px 0}
.card{
  background:#1a1a1a;margin:10px auto;
  padding:12px;border-radius:14px;
  max-width:420px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
}
.item{
  font-size:26px;padding:10px;
  border-radius:12px;
  background:#222;cursor:pointer;
}
.hot{box-shadow:0 0 10px orange}
button{
  padding:8px 14px;border-radius:10px;
  border:none;margin:4px;cursor:pointer;
}
.active{background:#ffb300;color:#000}
.small{font-size:13px;color:#bbb}

/* Ø´Ø±ÙŠØ· Scroll */
.bar{
  display:flex;
  gap:6px;
  overflow-x:auto;
  padding:6px;
}
.bar::-webkit-scrollbar{height:6px}
.bar::-webkit-scrollbar-thumb{
  background:#555;border-radius:10px;
}
.round{
  background:#1f1f1f;
  padding:4px 6px;
  border-radius:8px;
  font-size:15px;
  display:flex;
  align-items:center;
  gap:4px;
  cursor:pointer;
  white-space:nowrap;
}
.num{font-size:9px;color:#777}

.green{color:#4caf50}
.red{color:#ff5252}
.warn{color:#ff9800}
</style>
</head>

<body>

<h1>Greedy Cat MAX ğŸ˜º</h1>

<div class="card">
  <div>ÙˆØ¶Ø¹ Ø§Ù„ØªÙˆÙ‚Ø¹</div>
  <button id="m32" onclick="setMode('32')">3 Ø®Ø¶Ø§Ø± + 2 Ù„Ø­ÙˆÙ…</button>
  <button id="m31" onclick="setMode('31')">3 Ø®Ø¶Ø§Ø± + 1 Ù„Ø­Ù…Ø©</button>
  <button id="m21p" onclick="setMode('21p')">2 Ø®Ø¶Ø§Ø± + 1 Ø²ÙŠØ§Ø¯Ø©</button>
</div>

<div class="card">
  <div class="grid" id="items"></div>
  <div class="small">
    Ø¶ØºØ· = ØªØ³Ø¬ÙŠÙ„  
    | Ø¶ØºØ· Ù…Ø·ÙˆÙ‘Ù„ = ğŸ”¥ HOT  
  </div>
  <button onclick="clearHot()">Ù…Ø³Ø­ HOT</button>
</div>

<div class="card">
  <div>ğŸ“œ Ø¢Ø®Ø± 20 Ø¯ÙˆØ± (Ø§Ø³Ø­Ø¨ â¬…ï¸â¡ï¸)</div>
  <div class="bar" id="bar"></div>
</div>

<div class="card">
  <div>ğŸ“Š Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„ØºØ§ÙŠØ¨Ø©</div>
  <div id="missing" class="small"></div>
</div>

<div class="card">
  <div>ğŸ”® Ø§Ù„ØªÙˆÙ‚Ø¹ Ø§Ù„Ø°ÙƒÙŠ (%)</div>
  <div id="alert" class="warn"></div>
  <div id="rec"></div>
</div>

<button onclick="resetAll()">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>

<script>
const veggies=["ğŸ¥•","ğŸŒ½","ğŸ…","ğŸŒ¶ï¸"];
const meats=["ğŸ—","ğŸ¦","ğŸŸ","ğŸ”"];
const items=[...veggies,...meats];

let history=JSON.parse(localStorage.getItem("history")||"[]");
let hot=JSON.parse(localStorage.getItem("hot")||"{}");
let mode=localStorage.getItem("mode")||"21p";

const itemsDiv=document.getElementById("items");
const barDiv=document.getElementById("bar");
const missDiv=document.getElementById("missing");
const recDiv=document.getElementById("rec");
const alertDiv=document.getElementById("alert");

/* Ø±Ø³Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
items.forEach(i=>{
  const d=document.createElement("div");
  d.className="item";
  d.innerText=i;
  d.onclick=()=>add(i);
  d.oncontextmenu=e=>{
    e.preventDefault();
    hot[i]=!hot[i];
    save(); render();
  };
  itemsDiv.appendChild(d);
});

function save(){
  localStorage.setItem("history",JSON.stringify(history));
  localStorage.setItem("hot",JSON.stringify(hot));
  localStorage.setItem("mode",mode);
}

function add(i){
  history.push(i);
  save(); render();
}

function removeAt(idx){
  history.splice(idx,1);
  save(); render();
}

function setMode(m){
  mode=m;
  save(); render();
}

function clearHot(){
  hot={}; save(); render();
}

function score(i){
  const last=history.lastIndexOf(i);
  const miss=last===-1?history.length:(history.length-last-1);
  const hotWeight=hot[i]?3:0;
  return miss+hotWeight;
}

function percent(i){
  const c=history.filter(x=>x===i).length;
  return history.length?((c/history.length)*100).toFixed(1):"0.0";
}

function render(){
  /* Ø²Ø± Ø§Ù„ÙˆØ¶Ø¹ */
  ["m32","m31","m21p"].forEach(id=>{
    document.getElementById(id).classList.remove("active");
  });
  document.getElementById("m"+mode).classList.add("active");

  /* Ø§Ù„Ø´Ø±ÙŠØ· */
  barDiv.innerHTML="";
  const start=Math.max(0,history.length-20);
  history.slice(-20).forEach((item,idx)=>{
    const r=document.createElement("div");
    r.className="round";
    r.onclick=()=>removeAt(start+idx);
    r.innerHTML=`<span class="num">${start+idx+1}</span><span>${item}</span>`;
    barDiv.appendChild(r);
  });

  /* Ø§Ù„ØºÙŠØ§Ø¨ */
  missDiv.innerHTML="";
  items.forEach(i=>{
    if(history.includes(i)){
      const g=history.length-history.lastIndexOf(i)-1;
      if(g>=5) missDiv.innerHTML+=`${i} ØºØ§ÙŠØ¨ ${g} Ø¯ÙˆØ±<br>`;
    }else if(history.length){
      missDiv.innerHTML+=`${i} Ù„Ù… ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ (${history.length})<br>`;
    }
  });

  /* ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø¬Ø¹ÙÙ„Ø© */
  alertDiv.innerText="";
  items.forEach(i=>{
    const c=history.filter(x=>x===i).length;
    if(c>=5) alertDiv.innerText="âš ï¸ ØªØ­Ø°ÙŠØ±: ÙÙŠÙ‡ Ø¬Ø¹ÙÙ„Ø© Ù…Ø­ØªÙ…Ù„Ø©";
  });

  /* Ø§Ù„ØªÙˆÙ‚Ø¹ */
  let picks=[];
  if(mode==="21p"){
    const v=veggies.map(i=>({i,s:score(i)}))
      .sort((a,b)=>b.s-a.s).slice(0,2);
    const e=items.filter(i=>!v.find(x=>x.i===i))
      .map(i=>({i,s:score(i)}))
      .sort((a,b)=>b.s-a.s)[0];
    picks=[...v,e];
  }else{
    const v=veggies.map(i=>({i,s:score(i)}))
      .sort((a,b)=>b.s-a.s).slice(0,3);
    const m=meats.map(i=>({i,s:score(i)}))
      .sort((a,b)=>b.s-a.s)
      .slice(0,mode==="32"?2:1);
    picks=[...v,...m];
  }

  recDiv.innerHTML="";
  picks.forEach(p=>{
    const cls=veggies.includes(p.i)?"green":"red";
    recDiv.innerHTML+=
      `<span class="${cls}">${p.i} ${percent(p.i)}%</span> `;
  });

  /* Ø¥Ø¨Ø±Ø§Ø² HOT */
  document.querySelectorAll(".item").forEach(d=>{
    d.classList.toggle("hot",hot[d.innerText]);
  });
}

function resetAll(){
  history=[]; hot={};
  save(); render();
}

render();
</script>

</body>
</html>
