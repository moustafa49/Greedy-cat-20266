<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ˜º Greedy Cat MAX â€“ Smart Control</title>

<style>
body{
  background:#0f0f0f;color:#fff;
  font-family:'Cairo',Tahoma,Arial;
  direction:rtl;text-align:center;margin:0
}
h1{margin:12px 0}
.card{
  background:#1a1a1a;
  margin:10px auto;
  padding:14px;
  border-radius:16px;
  max-width:560px;
  box-shadow:0 0 14px #000
}
.grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px
}
.btn{
  font-size:2em;
  padding:12px 0;
  border-radius:14px;
  cursor:pointer;
  background:#161616;
  border:2px solid #333;
  position:relative;
}
.btn.hot{
  border-color:#ff9800;
  box-shadow:0 0 10px #ff980088;
}
.hotTag{
  position:absolute;
  top:2px;right:4px;
  font-size:.6em;
  color:#ff9800;
}
.bar span{
  cursor:pointer;
  padding:2px 4px;
  border-radius:6px;
}
.bar span:hover{
  background:#ff5555;
}
.bar{font-size:1.4em;line-height:2}
.reco{font-size:1.4em;line-height:2}
.small{font-size:.85em;color:#aaa}
.toggle{
  padding:6px 12px;
  margin:4px;
  border-radius:10px;
  border:none;
  background:#333;
  color:#fff;
  cursor:pointer;
}
.toggle.active{
  background:#ff9800;
  color:#000;
}
.green{color:#4caf50}
.red{color:#ff7676}
.blue{color:#4fc3f7}
</style>
</head>

<body>

<h1>ğŸ˜º Greedy Cat MAX</h1>

<!-- Ø§Ù„ÙˆØ¶Ø¹ -->
<div class="card">
  ğŸ”€ ÙˆØ¶Ø¹ Ø§Ù„ØªÙˆÙ‚Ø¹:
  <br>
  <button class="toggle active" onclick="setMode('3v2')" id="m32">3 Ø®Ø¶Ø§Ø± + 2 Ù„Ø­ÙˆÙ…</button>
  <button class="toggle" onclick="setMode('3v1')" id="m31">3 Ø®Ø¶Ø§Ø± + 1 Ù„Ø­Ù…Ø©</button>
</div>

<!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
<div class="card">
  <div class="grid" id="buttons"></div>
  <div class="small">
    Ø¶ØºØ·Ø© = ØªØ³Ø¬ÙŠÙ„ Ø¯ÙˆØ±<br>
    Ø¯Ø¨Ù„ ÙƒÙ„ÙŠÙƒ = HOT ğŸ”¥<br>
    Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· = Ø­Ø°Ù Ø§Ù„ØºÙ„Ø·Ø© âŒ
  </div>
</div>

<!-- Ø§Ù„Ø´Ø±ÙŠØ· -->
<div class="card">
  ğŸ“‹ Ø¢Ø®Ø± 20 Ø¯ÙˆØ± (Ø§Ø¶ØºØ· Ù„Ù„Ø­Ø°Ù):
  <div class="bar" id="last20">(ÙØ§Ø±Øº)</div>
</div>

<!-- Ø§Ù„ØªÙˆÙ‚Ø¹ -->
<div class="card">
  ğŸ”® Ø§Ù„ØªÙˆÙ‚Ø¹ Ø§Ù„Ø°ÙƒÙŠ:
  <div class="reco" id="recommendation">(Ø³Ø¬Ù‘Ù„ Ù„Ø¹Ø¨)</div>
</div>

<div class="card">
  <button onclick="resetAll()">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„ ğŸ—‘ï¸</button>
</div>

<script>
const meats = ["ğŸ”","ğŸŸ","ğŸ¦","ğŸ—"];
const veggies = ["ğŸ¥•","ğŸŒ½","ğŸ…","ğŸŒ¶ï¸"];
const items = [...meats, ...veggies];

let mode = "3v2";

let data = JSON.parse(localStorage.getItem("gc_delete_ai")) || {
  history: [],
  hot: {}
};

function save(){
  localStorage.setItem("gc_delete_ai", JSON.stringify(data));
}

// ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ¶Ø¹
function setMode(m){
  mode = m;
  document.getElementById("m32").classList.remove("active");
  document.getElementById("m31").classList.remove("active");
  document.getElementById(m==="3v2"?"m32":"m31").classList.add("active");
  render();
}

// ØªØ³Ø¬ÙŠÙ„ Ø¯ÙˆØ±
function addItem(item){
  data.history.push(item);

  // ØªØ­Ø¯ÙŠØ« Ø«Ù‚Ø© HOT
  Object.keys(data.hot).forEach(h=>{
    if(h === item){
      data.hot[h] = Math.min(data.hot[h] + 1, 5);
    } else {
      data.hot[h] = Math.max(data.hot[h] - 1, 0);
      if(data.hot[h] === 0) delete data.hot[h];
    }
  });

  save(); render();
}

// HOT
function toggleHot(item){
  if(!data.hot[item]) data.hot[item] = 1;
  else delete data.hot[item];
  save(); render();
}

// Ø­Ø°Ù Ø¹Ù†ØµØ± ÙˆØ§Ø­Ø¯ (ØºÙ„Ø·Ø©)
function removeAt(indexFromEnd){
  const idx = data.history.length - 1 - indexFromEnd;
  if(idx >= 0){
    data.history.splice(idx,1);
    save(); render();
  }
}

// Ø£Ø²Ø±Ø§Ø±
function renderButtons(){
  let html="";
  items.forEach(i=>{
    html += `
    <div class="btn ${data.hot[i]?'hot':''}"
      onclick="addItem('${i}')"
      ondblclick="toggleHot('${i}')">
      ${i}${data.hot[i]?'<div class="hotTag">ğŸ”¥</div>':''}
    </div>`;
  });
  document.getElementById("buttons").innerHTML = html;
}

// Ø´Ø±ÙŠØ·
function renderLast20(){
  const last20 = data.history.slice(-20).reverse();
  if(!last20.length){
    document.getElementById("last20").innerText="(ÙØ§Ø±Øº)";
    return;
  }
  let html="";
  last20.forEach((i,idx)=>{
    html += `<span onclick="removeAt(${idx})">${i}</span> `;
  });
  document.getElementById("last20").innerHTML = html;
}

// score
function score(item){
  const t = data.history.length;
  const last20 = data.history.slice(-20);
  const totalC = data.history.filter(x=>x===item).length;
  const lastC = last20.filter(x=>x===item).length;
  const lastIdx = data.history.lastIndexOf(item);
  const gap = lastIdx === -1 ? t : t-lastIdx;

  let s =
    (totalC/t)*35 +
    (lastC/20)*35 +
    Math.min(gap,20)*2;

  if(data.hot[item]) s += data.hot[item]*2;
  return {score:s, gap:gap, lastC:lastC};
}

// Ø§Ù„ØªÙˆÙ‚Ø¹
function renderRecommendation(){
  if(data.history.length < 5){
    document.getElementById("recommendation").innerText="Ø³Ø¬Ù‘Ù„ Ø£Ø¯ÙˆØ§Ø± Ø£ÙƒØªØ±";
    return;
  }

  const vegNeed = 3;
  const meatNeed = mode==="3v2" ? 2 : 1;

  const rankedVeg = veggies.map(v=>({i:v,...score(v)}))
    .sort((a,b)=>b.score-a.score);

  const rankedMeat = meats.map(m=>({i:m,...score(m)}))
    .sort((a,b)=>b.score-a.score);

  const pickVeg = rankedVeg.slice(0,vegNeed);
  const pickMeat = rankedMeat.slice(0,meatNeed);

  let html="";
  function draw(p){
    if(p.gap>=10) return `<span class="blue">${p.i}</span>`;
    if(p.lastC>=3) return `<span class="green">${p.i}</span>`;
    return p.i;
  }

  pickVeg.forEach(p=>html+=draw(p)+" ");
  pickMeat.forEach(p=>html+=draw(p)+" ");

  document.getElementById("recommendation").innerHTML = html;
}

function resetAll(){
  if(confirm("Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")){
    data={history:[],hot:{}};
    save(); render();
  }
}

function render(){
  renderButtons();
  renderLast20();
  renderRecommendation();
}

render();
</script>

</body>
</html>
