<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ˜º Greedy Cat MAX â€” Safe Mode</title>

<style>
body{
  background:#0f0f0f;color:#fff;
  font-family:Tahoma,Arial;direction:rtl;text-align:center;
}
h1{margin:10px 0}
.card{
  background:#1a1a1a;margin:10px auto;padding:12px;
  border-radius:14px;max-width:420px;
}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.item{
  font-size:26px;padding:10px;border-radius:12px;
  background:#222;cursor:pointer;user-select:none;
}
.hot{box-shadow:0 0 10px #ff9800}
button{
  padding:8px 14px;border-radius:10px;border:none;
  margin:4px;cursor:pointer;
}
.active{background:#ffb300;color:#000}
.small{font-size:13px;color:#bbb}

/* Ø´Ø±ÙŠØ· ØµØºÙŠØ± Scroll */
.bar{
  display:flex;gap:6px;overflow-x:auto;padding:6px;
}
.bar::-webkit-scrollbar{height:6px}
.bar::-webkit-scrollbar-thumb{background:#555;border-radius:10px}
.round{
  background:#1f1f1f;padding:4px 6px;border-radius:8px;
  font-size:15px;display:flex;align-items:center;gap:4px;
  cursor:pointer;white-space:nowrap;
}
.num{font-size:9px;color:#777}

.green{color:#4caf50}
.red{color:#ff5252}
.warn{color:#ff9800}
</style>
</head>

<body>

<h1>Greedy Cat MAX ğŸ˜º</h1>

<div class="card">
  <div>ÙˆØ¶Ø¹ Ø§Ù„ØªÙˆÙ‚Ø¹ (ØªØ­Ù„ÙŠÙ„ ÙÙ‚Ø·)</div>
  <button id="m32" onclick="setMode('32')">3 Ø®Ø¶Ø§Ø± + 2 Ù„Ø­ÙˆÙ…</button>
  <button id="m31" onclick="setMode('31')">3 Ø®Ø¶Ø§Ø± + 1 Ù„Ø­Ù…Ø©</button>
  <button id="m21p" onclick="setMode('21p')" class="active">2 Ø®Ø¶Ø§Ø± + 1 Ø²ÙŠØ§Ø¯Ø©</button>
</div>

<div class="card">
  <div class="grid" id="items"></div>
  <div class="small">Ø¶ØºØ· = ØªØ³Ø¬ÙŠÙ„ | Ø¶ØºØ· Ù…Ø·ÙˆÙ‘Ù„ = ğŸ”¥ HOT (Ø¥Ø´Ø§Ø±Ø© ÙÙ‚Ø·)</div>
  <button onclick="clearHot()">Ù…Ø³Ø­ HOT</button>
</div>

<div class="card">
  <div>ğŸ“œ Ø¢Ø®Ø± 20 Ø¯ÙˆØ± (Ø§Ø³Ø­Ø¨ â¬…ï¸â¡ï¸ | Ø§Ø¶ØºØ· Ù„Ù„Ø­Ø°Ù)</div>
  <div class="bar" id="bar"></div>
</div>

<div class="card">
  <div>ğŸ“Š Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„ØºØ§ÙŠØ¨Ø©</div>
  <div id="missing" class="small"></div>
</div>

<div class="card">
  <div>ğŸ”® ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª (%)</div>
  <div id="alert" class="warn"></div>
  <div id="rec"></div>
</div>

<button onclick="resetAll()">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>

<script>
/* Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
const veggies=["ğŸ¥•","ğŸŒ½","ğŸ…","ğŸŒ¶ï¸"];
const meats=["ğŸ—","ğŸ¦","ğŸŸ","ğŸ”"];
const items=[...veggies,...meats];

let history=JSON.parse(localStorage.getItem("history")||"[]");
let hot=JSON.parse(localStorage.getItem("hot")||"{}");
let mode=localStorage.getItem("mode")||"21p";

const itemsDiv=document.getElementById("items");
const barDiv=document.getElementById("bar");
const missDiv=document.getElementById("missing");
const recDiv=document.getElementById("rec");
const alertDiv=document.getElementById("alert");

/* Ø±Ø³Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
items.forEach(i=>{
  const d=document.createElement("div");
  d.className="item";
  d.innerText=i;
  d.onclick=()=>add(i);
  d.oncontextmenu=e=>{
    e.preventDefault();
    hot[i]=!hot[i];
    save(); render();
  };
  itemsDiv.appendChild(d);
});

function save(){
  localStorage.setItem("history",JSON.stringify(history));
  localStorage.setItem("hot",JSON.stringify(hot));
  localStorage.setItem("mode",mode);
}

/* Ø¥Ø¶Ø§ÙØ©/Ø­Ø°Ù */
function add(i){ history.push(i); save(); render(); }
function removeAt(idx){ history.splice(idx,1); save(); render(); }
function resetAll(){ history=[]; hot={}; save(); render(); }
function clearHot(){ hot={}; save(); render(); }

/* ÙˆØ¶Ø¹ */
function setMode(m){
  mode=m; save();
  ["m32","m31","m21p"].forEach(id=>document.getElementById(id).classList.remove("active"));
  document.getElementById("m"+m).classList.add("active");
  render();
}

/* Ù…ÙƒØ§ÙØ­Ø© Ø§Ù„Ø¬Ø¹ÙÙ„Ø© */
function recentPenalty(item){
  const last3 = history.slice(-3);
  return last3.filter(x=>x===item).length * 4; // Ø¹Ù‚ÙˆØ¨Ø© Ù‚ÙˆÙŠØ©
}

/* Ø³ÙƒÙ‘ÙˆØ± Ø¢Ù…Ù† */
function score(item){
  const last=history.lastIndexOf(item);
  const miss = last===-1 ? history.length : (history.length-last-1);
  const missWeight = Math.min(miss, 10); // Ø³Ù‚Ù Ù„Ù„ØºÙŠØ§Ø¨
  const hotWeight = hot[item] ? 2 : 0;   // HOT Ø¶Ø¹ÙŠÙ
  return missWeight + hotWeight - recentPenalty(item);
}

/* Ù†Ø³Ø¨Ø© */
function percent(item){
  const c=history.filter(x=>x===item).length;
  return history.length?((c/history.length)*100).toFixed(1):"0.0";
}

/* ÙØ±ÙŠØ¯Ø© (Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„ØªÙˆÙ‚Ø¹) */
function uniquePicks(arr){
  const used=new Set();
  return arr.filter(p=>{
    if(used.has(p.i)) return false;
    used.add(p.i); return true;
  });
}

function render(){
  /* Ø¥Ø¨Ø±Ø§Ø² HOT */
  document.querySelectorAll(".item").forEach(d=>{
    d.classList.toggle("hot",!!hot[d.innerText]);
  });

  /* Ø§Ù„Ø´Ø±ÙŠØ· */
  barDiv.innerHTML="";
  const start=Math.max(0,history.length-20);
  history.slice(-20).forEach((item,idx)=>{
    const r=document.createElement("div");
    r.className="round";
    r.onclick=()=>removeAt(start+idx);
    r.innerHTML=`<span class="num">${start+idx+1}</span><span>${item}</span>`;
    barDiv.appendChild(r);
  });

  /* Ø§Ù„ØºÙŠØ§Ø¨ */
  missDiv.innerHTML="";
  items.forEach(i=>{
    if(history.includes(i)){
      const g=history.length-history.lastIndexOf(i)-1;
      if(g>=5) missDiv.innerHTML+=`${i} ØºØ§ÙŠØ¨ ${g} Ø¯ÙˆØ±<br>`;
    }else if(history.length){
      missDiv.innerHTML+=`${i} Ù„Ù… ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ (${history.length})<br>`;
    }
  });

  /* ØªØ­Ø°ÙŠØ± */
  alertDiv.innerText="";
  items.forEach(i=>{
    if(history.slice(-3).filter(x=>x===i).length>=2){
      alertDiv.innerText="âš ï¸ ØªØ­Ø°ÙŠØ±: ØªÙƒØ±Ø§Ø± Ù‚Ø±ÙŠØ¨ (Ø¬Ø¹ÙÙ„Ø©)";
    }
  });

  /* ØªØ­Ù„ÙŠÙ„ (Ø¨Ø¯ÙˆÙ† ÙØ±Ø¶ Ù„Ø¹Ø¨) */
  let picks=[];
  if(mode==="21p"){
    const v=veggies.map(i=>({i,s:score(i)})).sort((a,b)=>b.s-a.s).slice(0,2);
    const e=items.filter(i=>!v.find(x=>x.i===i))
      .map(i=>({i,s:score(i)})).sort((a,b)=>b.s-a.s)[0];
    picks=[...v,e];
  }else{
    const v=veggies.map(i=>({i,s:score(i)})).sort((a,b)=>b.s-a.s).slice(0,3);
    const m=meats.map(i=>({i,s:score(i)}))
      .sort((a,b)=>b.s-a.s).slice(0,mode==="32"?2:1);
    picks=[...v,...m];
  }
  picks=uniquePicks(picks);

  recDiv.innerHTML="";
  picks.forEach(p=>{
    const cls=veggies.includes(p.i)?"green":"red";
    recDiv.innerHTML+=`<span class="${cls}">${p.i} ${percent(p.i)}%</span> `;
  });
}

render();
</script>

</body>
</html>
