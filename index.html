<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Greedy Cat â€“ Final Smart Veg</title>

<style>
body{background:#0f0f0f;color:#fff;font-family:Tahoma;margin:0;text-align:center}
h1{margin:10px}
.box{background:#1a1a1a;border-radius:14px;padding:12px;margin:10px auto;max-width:440px}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.item{font-size:26px;padding:10px;border-radius:12px;background:#222;cursor:pointer}
.mode{padding:6px 10px;border-radius:10px;background:#333;margin:4px;cursor:pointer}
.mode.active{background:#ff9800;color:#000}
.bar{display:flex;flex-direction:row-reverse;gap:6px;overflow-x:auto;padding:6px}
.round{background:#333;padding:4px 6px;border-radius:8px;display:flex;gap:4px;cursor:pointer}
.num{font-size:10px;color:#aaa}
.green{color:#4caf50}
.red{color:#ff5252}
.orange{color:#ff9800}
.percent{font-size:13px}
.small{font-size:13px;color:#bbb}
</style>
</head>

<body>

<h1>ğŸ¥• Greedy Cat â€“ Smart Veg (Final)</h1>

<div class="box">
<b>ÙˆØ¶Ø¹ Ø§Ù„ØªÙˆÙ‚Ø¹</b><br>
<span class="mode active" onclick="setMode('33')">3 + 3</span>
<span class="mode" onclick="setMode('32')">3 + 2</span>
<span class="mode" onclick="setMode('31')">3 + 1</span>
<span class="mode" onclick="setMode('R')">ğŸ” ØªÙƒØ±Ø§Ø±</span>
</div>

<div class="box">
<div class="grid" id="items"></div>
<div class="small">Ø§Ø¶ØºØ· Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±</div>
</div>

<div class="box">
<b>Ø¢Ø®Ø± 20 Ø¯ÙˆØ±</b>
<div class="bar" id="bar"></div>
</div>

<div class="box">
<b>â³ Ø§Ù„ØºØ§ÙŠØ¨</b>
<div id="missing" class="small"></div>
</div>

<div class="box">
<b>ğŸ”® Ø§Ù„ØªÙˆÙ‚Ø¹</b>
<div id="prediction"></div>
</div>

<script>
const veggies=["ğŸ¥•","ğŸŒ½","ğŸ…","ğŸŒ¶ï¸"];
const meats=[
 {i:"ğŸ¦",mult:10},
 {i:"ğŸ„",mult:15},
 {i:"ğŸŸ",mult:25},
 {i:"ğŸ”",mult:45}
];
const all=[...veggies,...meats.map(m=>m.i)];

let history=[], mode="33";

const itemsDiv=document.getElementById("items");
const barDiv=document.getElementById("bar");
const missingDiv=document.getElementById("missing");
const predDiv=document.getElementById("prediction");

all.forEach(i=>{
 const d=document.createElement("div");
 d.className="item";
 d.textContent=i;
 d.onclick=()=>{history.push(i);render()};
 itemsDiv.appendChild(d);
});

function setMode(m){
 mode=m;
 document.querySelectorAll(".mode").forEach(x=>x.classList.remove("active"));
 event.target.classList.add("active");
 render();
}

function repeatStatus(i){
 const c=history.slice(-3).filter(x=>x===i).length;
 if(c>=3) return "block";
 if(c==2) return "high";
 if(c==1) return "maybe";
 return "safe";
}

function vegScore(i){
 if(repeatStatus(i)==="block") return -999;
 const last=history.lastIndexOf(i);
 const miss=last===-1?20:history.length-last-1;
 const repeatBonus=repeatStatus(i)==="maybe"?3:0;
 return miss+repeatBonus;
}

function meatScore(m){
 if(repeatStatus(m.i)==="block") return -999;
 const last=history.lastIndexOf(m.i);
 const miss=last===-1?6:history.length-last-1;
 return miss-(m.mult/4);
}

function render(){
 /* Ø§Ù„Ø´Ø±ÙŠØ· */
 barDiv.innerHTML="";
 const start=Math.max(0,history.length-20);
 history.slice(-20).forEach((it,idx)=>{
  const r=document.createElement("div");
  r.className="round";
  r.onclick=()=>{history.splice(start+idx,1);render()};
  r.innerHTML=`<span class="num">${start+idx+1}</span><span>${it}</span>`;
  barDiv.appendChild(r);
 });

 /* Ø§Ù„ØºØ§ÙŠØ¨ (Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·) */
 missingDiv.innerHTML="";
 all.forEach(i=>{
  const last=history.lastIndexOf(i);
  const gap=last===-1?history.length:history.length-last-1;
  missingDiv.innerHTML+=`${i} ${gap}<br>`;
 });

 /* ØªØ±ØªÙŠØ¨ */
 const vRank=veggies.map(i=>({i,s:vegScore(i),r:repeatStatus(i)}))
                    .sort((a,b)=>b.s-a.s);
 const mRank=meats.map(m=>({i:m.i,s:meatScore(m)}))
                   .sort((a,b)=>b.s-a.s);

 let picks=[];

 if(mode==="R"){
   const top=vRank[0];
   picks.push(top);
   if(top.r==="maybe" || top.r==="high") picks.push(top);
 }

 if(mode==="31"){
   const top=vRank[0];
   picks.push(top);
   if(top.r==="maybe") picks.push(top);
   picks.push(mRank[0]);
 }

 if(mode==="32"){
   picks=[...vRank.slice(0,3),...mRank.slice(0,2)];
 }

 if(mode==="33"){
   picks=[...vRank.slice(0,3),...mRank.slice(0,3)];
 }

 const sum=picks.reduce((a,b)=>a+Math.max(b.s,0),0)||1;
 predDiv.innerHTML=picks.map(p=>{
  const isVeg=veggies.includes(p.i);
  const cls=isVeg?"green":"red";
  const tag=p.r==="maybe"?" ğŸ”":"";
  return `<span class="${cls}">${p.i}${tag} ${(Math.max(p.s,0)/sum*100).toFixed(1)}%</span>`;
 }).join(" ");
}

render();
</script>

</body>
</html>
