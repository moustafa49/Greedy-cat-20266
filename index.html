<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Greedy Cat MAX â€“ Smart System</title>

<style>
body{
  background:#0f0f0f;color:#fff;font-family:Tahoma;text-align:center;margin:0
}
h1{margin:10px}
.box{
  background:#1a1a1a;border-radius:14px;
  padding:12px;margin:10px auto;max-width:460px
}
.grid{
  display:grid;grid-template-columns:repeat(4,1fr);gap:8px
}
.item{
  font-size:26px;padding:10px;border-radius:12px;
  background:#222;cursor:pointer;user-select:none
}
.item.hot{outline:3px solid orange}
.modes{
  display:grid;grid-template-columns:repeat(3,1fr);gap:6px
}
.mode{
  padding:6px;border-radius:10px;background:#333;cursor:pointer
}
.mode.active{background:#ff9800;color:#000}
.bar{
  display:flex;gap:6px;overflow-x:auto;padding:6px
}
.bar span{
  background:#333;padding:4px 8px;border-radius:8px;cursor:pointer
}
.small{font-size:13px;color:#bbb}
.green{color:#4caf50}
.red{color:#ff5252}
.orange{color:#ff9800}
</style>
</head>

<body>

<h1>ğŸ˜º Greedy Cat MAX</h1>

<div class="box">
<b>ÙˆØ¶Ø¹ Ø§Ù„ØªÙˆÙ‚Ø¹</b>
<div class="modes">
  <div class="mode active" onclick="setMode('3+1')">3+1</div>
  <div class="mode" onclick="setMode('3+2')">3+2</div>
  <div class="mode" onclick="setMode('3+3')">3+3</div>
  <div class="mode" onclick="setMode('reserve')">Ø§Ø­ØªÙŠØ§Ø·ÙŠ 5</div>
  <div class="mode" onclick="setMode('repeat')">ğŸ” ØªÙƒØ±Ø§Ø±</div>
  <div class="mode" onclick="setMode('confuse')">ğŸ”¥ Ø¬Ø¹ÙÙ„Ø©</div>
</div>
</div>

<div class="box">
<div class="grid" id="items"></div>
<div class="small">Ø¶ØºØ· = ØªØ³Ø¬ÙŠÙ„ | Ø¶ØºØ· Ù…Ø·ÙˆÙ‘Ù„ = HOT</div>
</div>

<div class="box">
<b>Ø¢Ø®Ø± 20 Ø¯ÙˆØ±</b>
<div class="bar" id="history"></div>
</div>

<div class="box">
<b>â³ Ø§Ù„ØºØ§ÙŠØ¨</b>
<div id="missing" class="small"></div>
</div>

<div class="box">
<b>ğŸ”® Ø§Ù„ØªÙˆÙ‚Ø¹</b>
<div id="prediction"></div>
</div>

<script>
/* ===== Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===== */
const veg=["ğŸ¥•","ğŸŒ½","ğŸ…","ğŸŒ¶ï¸"];
const meat=["ğŸ¦","ğŸ„","ğŸŸ","ğŸ”"];
const all=[...veg,...meat];

const weight={
  "ğŸ¥•":5,"ğŸŒ½":5,"ğŸ…":5,"ğŸŒ¶ï¸":5,
  "ğŸ¦":10,"ğŸ„":15,"ğŸŸ":25,"ğŸ”":45
};

let history=[];
let hot=new Set();
let mode="3+1";

/* ===== Ø±Ø³Ù… Ø§Ù„Ø£ØµÙ†Ø§Ù ===== */
const itemsDiv=document.getElementById("items");
all.forEach(i=>{
  const d=document.createElement("div");
  d.className="item";
  d.textContent=i;
  let t;
  d.onclick=()=>{history.unshift(i);if(history.length>100)history.pop();render()};
  d.onmousedown=()=>{t=setTimeout(()=>{toggleHot(i)},600)};
  d.onmouseup=()=>clearTimeout(t);
  itemsDiv.appendChild(d);
});

function toggleHot(i){
  hot.has(i)?hot.delete(i):hot.add(i);
  render();
}

function setMode(m){
  mode=m;
  document.querySelectorAll(".mode").forEach(x=>x.classList.remove("active"));
  event.target.classList.add("active");
  render();
}

/* ===== Ø­Ø³Ø§Ø¨Ø§Øª ===== */
function lastGap(i){
  const idx=history.indexOf(i);
  return idx===-1?history.length:idx;
}
function recentCount(i){
  return history.slice(0,6).filter(x=>x===i).length;
}

function smartScore(i){
  let s=0;
  s += Math.min(lastGap(i),12);          // Ø§Ù„ØºÙŠØ§Ø¨
  s += recentCount(i)*2;                 // ØªÙƒØ±Ø§Ø± Ø·Ø¨ÙŠØ¹ÙŠ
  if(hot.has(i)) s+=2;                   // HOT
  s -= weight[i]/10;                     // ÙˆØ²Ù† Ø§Ù„Ø¶Ø±Ø¨
  return s;
}

/* ===== Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªÙˆÙ‚Ø¹ ===== */
function buildPrediction(){
  let picks=[];

  if(mode==="repeat"){
    picks = all
      .sort((a,b)=>recentCount(b)-recentCount(a))
      .slice(0,3);
  }

  if(mode==="confuse"){
    // ÙˆØ¶Ø¹ Ø¬Ø¹ÙÙ„Ø©: 4 Ø§Ø®ØªÙŠØ§Ø±Ø§Øª "Ù…Ù…ÙƒÙ† ØªÙŠØ¬ÙŠ" Ø¨Ø¯ÙˆÙ† Ø§Ù†Ø¯ÙØ§Ø¹
    picks = all
      .filter(i=>recentCount(i)<=2)        // Ù…Ø´ Ù…Ø­Ø±ÙˆÙ‚
      .sort((a,b)=>smartScore(b)-smartScore(a))
      .slice(0,4);
  }

  if(mode==="3+1"){
    picks=[
      ...veg.sort((a,b)=>smartScore(b)-smartScore(a)).slice(0,3),
      ...meat.sort((a,b)=>smartScore(b)-smartScore(a)).slice(0,1)
    ];
  }

  if(mode==="3+2"){
    picks=[
      ...veg.sort((a,b)=>smartScore(b)-smartScore(a)).slice(0,3),
      ...meat.sort((a,b)=>smartScore(b)-smartScore(a)).slice(0,2)
    ];
  }

  if(mode==="3+3"){
    picks=[
      ...veg.sort((a,b)=>smartScore(b)-smartScore(a)).slice(0,3),
      ...meat.sort((a,b)=>smartScore(b)-smartScore(a)).slice(0,3)
    ];
  }

  if(mode==="reserve"){
    const meatSignal = meat.some(m=>recentCount(m)>=2 || hot.has(m));
    picks = meatSignal
      ? [...meat.sort((a,b)=>smartScore(b)-smartScore(a)).slice(0,4),
         ...veg.sort((a,b)=>smartScore(b)-smartScore(a)).slice(0,2)]
      : [...veg.sort((a,b)=>smartScore(b)-smartScore(a)).slice(0,4),
         ...meat.sort((a,b)=>smartScore(b)-smartScore(a)).slice(0,2)];
  }

  return picks;
}

/* ===== Ø±Ø³Ù… ===== */
function render(){
  // Ø§Ù„Ø´Ø±ÙŠØ·
  const h=document.getElementById("history");
  h.innerHTML="";
  history.slice(0,20).forEach((i,idx)=>{
    const s=document.createElement("span");
    s.textContent=(idx+1)+"-"+i;
    s.onclick=()=>{history.splice(idx,1);render()};
    h.appendChild(s);
  });

  // Ø§Ù„ØºØ§ÙŠØ¨ Ø£ÙÙ‚ÙŠ
  document.getElementById("missing").innerHTML=
    all.map(i=>`${i} ${lastGap(i)}`).join(" | ");

  // Ø§Ù„ØªÙˆÙ‚Ø¹
  const picks=buildPrediction();
  document.getElementById("prediction").innerHTML=
    picks.map(i=>{
      const cls=veg.includes(i)?"green":"red";
      const tag=recentCount(i)>0?" ğŸ”":"";
      return `<span class="${cls}">${i}${tag}</span>`;
    }).join(" ");

  // HOT UI
  document.querySelectorAll(".item").forEach(d=>{
    d.classList.toggle("hot",hot.has(d.textContent));
  });
}
render();
</script>

</body>
</html>
