<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Greedy Cat â€“ Final Complete</title>

<style>
body{background:#0f0f0f;color:#fff;font-family:Tahoma;margin:0;text-align:center}
h1{margin:10px}
.box{background:#1a1a1a;border-radius:14px;padding:12px;margin:10px auto;max-width:460px}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.item{font-size:26px;padding:10px;border-radius:12px;background:#222;cursor:pointer;user-select:none}
.item.hot{outline:2px solid orange}
.mode{padding:6px 10px;border-radius:10px;background:#333;margin:4px;cursor:pointer}
.mode.active{background:#ff9800;color:#000}
.bar{display:flex;flex-direction:row-reverse;gap:6px;overflow-x:auto;padding:6px}
.round{background:#333;padding:4px 6px;border-radius:8px;display:flex;gap:4px;cursor:pointer}
.num{font-size:10px;color:#aaa}
.green{color:#4caf50}
.red{color:#ff5252}
.orange{color:#ff9800}
.percent{font-size:13px}
.small{font-size:13px;color:#bbb}
</style>
</head>

<body>

<h1>ğŸ˜º Greedy Cat â€“ Final</h1>

<div class="box">
<b>ÙˆØ¶Ø¹ Ø§Ù„ØªÙˆÙ‚Ø¹</b><br>
<span class="mode active" onclick="setMode('33')">3 + 3</span>
<span class="mode" onclick="setMode('32')">3 + 2</span>
<span class="mode" onclick="setMode('31')">3 + 1</span>
<span class="mode" onclick="setMode('R')">ğŸ” ØªÙƒØ±Ø§Ø±</span>
</div>

<div class="box">
<div class="grid" id="items"></div>
<div class="small">Ø¶ØºØ· = ØªØ³Ø¬ÙŠÙ„ | Ø¶ØºØ· Ù…Ø·ÙˆÙ‘Ù„ = HOT</div>
</div>

<div class="box">
<b>Ø¢Ø®Ø± 20 Ø¯ÙˆØ±</b>
<div class="bar" id="bar"></div>
</div>

<div class="box">
<b>â³ Ø§Ù„ØºØ§ÙŠØ¨</b>
<div id="missing" class="small"></div>
</div>

<div class="box">
<b>ğŸ”® Ø§Ù„ØªÙˆÙ‚Ø¹</b>
<div id="prediction"></div>
</div>

<script>
/* ===== Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===== */
const veggies=["ğŸ¥•","ğŸŒ½","ğŸ…","ğŸŒ¶ï¸"];
const meats=[
 {i:"ğŸ¦",mult:10},
 {i:"ğŸ„",mult:15},
 {i:"ğŸŸ",mult:25},
 {i:"ğŸ”",mult:45}
];
const all=[...veggies,...meats.map(m=>m.i)];

let history=[];
let hotManual=new Set();
let mode="33";

/* ===== DOM ===== */
const itemsDiv=document.getElementById("items");
const barDiv=document.getElementById("bar");
const missingDiv=document.getElementById("missing");
const predDiv=document.getElementById("prediction");

/* ===== Ø±Ø³Ù… Ø§Ù„Ø£ØµÙ†Ø§Ù ===== */
all.forEach(i=>{
 const d=document.createElement("div");
 d.className="item";
 d.textContent=i;
 let press;
 d.onclick=()=>{history.push(i);render()};
 d.onmousedown=()=>{press=setTimeout(()=>{toggleHot(i)},600)};
 d.onmouseup=()=>clearTimeout(press);
 itemsDiv.appendChild(d);
});

function toggleHot(i){
 if(hotManual.has(i)) hotManual.delete(i);
 else hotManual.add(i);
 render();
}

/* ===== ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ¶Ø¹ ===== */
function setMode(m){
 mode=m;
 document.querySelectorAll(".mode").forEach(x=>x.classList.remove("active"));
 event.target.classList.add("active");
 render();
}

/* ===== Ø­Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø± ===== */
function repeatCount(i){
 return history.slice(-5).filter(x=>x===i).length;
}

/* ===== Ø³ÙƒÙˆØ±Ø§Øª ===== */
function vegScore(i){
 const last=history.lastIndexOf(i);
 const miss=last===-1?20:history.length-last-1;
 const rep=repeatCount(i);
 if(rep>=3) return -999;
 return miss + rep*2 + (hotManual.has(i)?2:0);
}
function meatScore(m){
 const last=history.lastIndexOf(m.i);
 const miss=last===-1?8:history.length-last-1;
 const rep=repeatCount(m.i);
 if(rep>=2) return -999;
 return miss - (m.mult/4) + (hotManual.has(m.i)?1:0);
}

/* ===== Ø§Ø®ØªÙŠØ§Ø± Ù…Ø±Ø´Ø­ÙŠÙ† ØªÙƒØ±Ø§Ø± ===== */
function repeatCandidates(){
 return all
  .map(i=>({
    i,
    c:repeatCount(i),
    s:veggies.includes(i)?vegScore(i):meatScore(meats.find(m=>m.i===i))
  }))
  .filter(x=>x.c>=1 && x.s>-500)
  .sort((a,b)=>(b.c*10+b.s)-(a.c*10+a.s))
  .slice(0,3);
}

/* ===== Ø§Ù„Ø±Ø³Ù… ===== */
function render(){

 /* Ø§Ù„Ø´Ø±ÙŠØ· */
 barDiv.innerHTML="";
 const start=Math.max(0,history.length-20);
 history.slice(-20).forEach((it,idx)=>{
  const r=document.createElement("div");
  r.className="round";
  r.onclick=()=>{history.splice(start+idx,1);render()};
  r.innerHTML=`<span class="num">${start+idx+1}</span><span>${it}</span>`;
  barDiv.appendChild(r);
 });

 /* Ø§Ù„ØºØ§ÙŠØ¨ */
 missingDiv.innerHTML="";
 all.forEach(i=>{
  const last=history.lastIndexOf(i);
  const gap=last===-1?history.length:history.length-last-1;
  missingDiv.innerHTML+=`${i} ${gap}<br>`;
 });

 /* Ø§Ù„ØªØ±ØªÙŠØ¨ */
 const vRank=veggies.map(i=>({i,s:vegScore(i)})).sort((a,b)=>b.s-a.s);
 const mRank=meats.map(m=>({i:m.i,s:meatScore(m)})).sort((a,b)=>b.s-a.s);
 const repeats=repeatCandidates();

 let picks=[];

 if(mode==="R"){
  repeats.forEach(r=>picks.push(r));
 }

 if(mode==="31"){
  const top=vRank[0];
  picks.push(top);
  if(repeatCount(top.i)>=1) picks.push(top);
  picks.push(mRank[0]);
 }

 if(mode==="32") picks=[...vRank.slice(0,3),...mRank.slice(0,2)];
 if(mode==="33") picks=[...vRank.slice(0,3),...mRank.slice(0,3)];

 const sum=picks.reduce((a,b)=>a+Math.max(b.s,0),0)||1;

 predDiv.innerHTML=picks.map(p=>{
  const isVeg=veggies.includes(p.i);
  const cls=isVeg?"green":"red";
  const tag=repeatCount(p.i)>=1?" ğŸ”":"";
  const pct=((Math.max(p.s,0)/sum)*100).toFixed(1);
  return `<span class="${cls}">${p.i}${tag} <span class="percent">${pct}%</span></span>`;
 }).join(" ");

 /* HOT UI */
 document.querySelectorAll(".item").forEach(d=>{
  d.classList.toggle("hot",hotManual.has(d.textContent));
 });
}

render();
</script>

</body>
</html>
