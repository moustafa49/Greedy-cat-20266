<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ğŸ˜º Greedy Cat MAX â€“ Safe Predictor</title>

<style>
body{
  background:#0f0f0f;color:#fff;
  font-family:Tahoma,Arial;
  text-align:center;margin:0;padding:10px
}
h1{margin:10px 0}
.box{
  background:#1a1a1a;
  border-radius:14px;
  padding:12px;
  margin:10px auto;
  max-width:420px
}
.grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px
}
.item{
  font-size:26px;
  padding:10px;
  border-radius:12px;
  background:#222;
  cursor:pointer
}
.hot{outline:2px solid orange}
.bar{
  display:flex;
  overflow-x:auto;
  gap:6px;
  padding:6px
}
.bar span{
  font-size:22px;
  cursor:pointer
}
.warn{color:#ff5252;font-weight:bold}
.ok{color:#4caf50}
.small{font-size:13px;opacity:.8}
</style>
</head>

<body>

<h1>ğŸ˜º Greedy Cat MAX</h1>

<div class="box">
<b>Ø§Ù„Ø£ØµÙ†Ø§Ù</b>
<div class="grid" id="items"></div>
<div class="small">Ø¶ØºØ· = ØªØ³Ø¬ÙŠÙ„ | Ø¶ØºØ· Ù…Ø·ÙˆÙ„ = HOT ğŸ”¥</div>
</div>

<div class="box">
<b>Ø¢Ø®Ø± 20 Ø¯ÙˆØ± (Ø§Ø¶ØºØ· Ù„Ù„Ø­Ø°Ù)</b>
<div class="bar" id="last20"></div>
</div>

<div class="box">
<b>Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„ØºØ§Ø¦Ø¨Ø©</b>
<div id="missing"></div>
</div>

<div class="box">
<b>âš ï¸ ØªØ­Ø°ÙŠØ± Ø§Ù„ØªÙƒØ±Ø§Ø±</b>
<div id="warning"></div>
</div>

<div class="box">
<b>ğŸ”® Ø§Ù„ØªÙˆÙ‚Ø¹ Ø§Ù„Ø°ÙƒÙŠ (3 Ø®Ø¶Ø§Ø± + 3 Ù„Ø­ÙˆÙ…)</b>
<div id="prediction"></div>
</div>

<div class="box">
<b>ğŸ“Š Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª %</b>
<div id="percentages"></div>
</div>

<button onclick="resetAll()">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>

<script>
const veggies=["ğŸ¥•","ğŸŒ½","ğŸ…","ğŸŒ¶ï¸"];
const meats=["ğŸ”","ğŸŸ","ğŸ¦","ğŸ—"];
const all=[...veggies,...meats];

let history=[];
let hot={};

const itemsDiv=document.getElementById("items");
const last20Div=document.getElementById("last20");
const missingDiv=document.getElementById("missing");
const warningDiv=document.getElementById("warning");
const predictionDiv=document.getElementById("prediction");
const percDiv=document.getElementById("percentages");

/* Ø±Ø³Ù… Ø§Ù„Ø£ØµÙ†Ø§Ù */
all.forEach(i=>{
  const d=document.createElement("div");
  d.className="item";
  d.textContent=i;
  let t;
  d.onclick=()=>{
    history.push(i);
    render();
  };
  d.onmousedown=()=>{
    t=setTimeout(()=>{
      hot[i]=!hot[i];
      render();
    },600);
  };
  d.onmouseup=()=>clearTimeout(t);
  itemsDiv.appendChild(d);
});

/* Ù…Ù†Ø¹ 3 ØªÙƒØ±Ø§Ø± */
function blocked(i){
  const l=history.slice(-2);
  return l.length===2 && l[0]===i && l[1]===i;
}

/* ØªØ­Ø°ÙŠØ± Ø§Ù„ØªÙƒØ±Ø§Ø± */
function repeatWarning(){
  const last5=history.slice(-5);
  let w=[];
  all.forEach(i=>{
    if(last5.filter(x=>x===i).length>=3)
      w.push(`${i} ØªÙƒØ±Ø§Ø± Ø¹Ø§Ù„ÙŠ`);
  });
  return w;
}

/* Ø­Ø³Ø§Ø¨ Ø³ÙƒÙ‘ÙˆØ± */
function score(i){
  if(blocked(i)) return -999;
  const last=history.lastIndexOf(i);
  const miss= last===-1 ? 20 : history.length-last-1;
  const missW=Math.min(miss,10);
  const hotW=hot[i]?2:0;
  return missW+hotW;
}

function render(){
  /* Ø¢Ø®Ø± 20 */
  last20Div.innerHTML="";
  history.slice(-20).forEach((i,idx)=>{
    const s=document.createElement("span");
    s.textContent=i;
    s.onclick=()=>{
      history.splice(history.length-20+idx,1);
      render();
    };
    last20Div.appendChild(s);
  });

  /* ØºÙŠØ§Ø¨ */
  missingDiv.innerHTML="";
  all.forEach(i=>{
    const last=history.lastIndexOf(i);
    if(last!==-1){
      const gap=history.length-last-1;
      if(gap>=5)
        missingDiv.innerHTML+=`${i} ØºØ§ÙŠØ¨ ${gap} Ø¯ÙˆØ±<br>`;
    }
  });

  /* ØªØ­Ø°ÙŠØ± */
  const w=repeatWarning();
  warningDiv.innerHTML=w.length
   ? `<span class="warn">${w.join(" | ")}</span>`
   : `<span class="ok">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø®Ø·Ø± ÙˆØ§Ø¶Ø­</span>`;

  /* ØªÙˆÙ‚Ø¹ */
  let scored=all.map(i=>({i,s:score(i)}))
               .sort((a,b)=>b.s-a.s);

  const pickVeg=scored.filter(x=>veggies.includes(x.i)).slice(0,3);
  const pickMeat=scored.filter(x=>meats.includes(x.i)).slice(0,3);
  const picks=[...pickVeg,...pickMeat];

  predictionDiv.textContent=picks.map(x=>x.i).join(" ");

  /* Ù†Ø³Ø¨ */
  const sum=picks.reduce((a,b)=>a+Math.max(b.s,0),0)||1;
  percDiv.innerHTML="";
  picks.forEach(p=>{
    percDiv.innerHTML+=`${p.i} ${(p.s/sum*100).toFixed(1)}% &nbsp; `;
  });

  /* ØªØ­Ø¯ÙŠØ« HOT Ø´ÙƒÙ„ */
  document.querySelectorAll(".item").forEach(d=>{
    d.classList.toggle("hot",hot[d.textContent]);
  });
}

function resetAll(){
  history=[];hot={};render();
}

render();
</script>
</body>
</html>
