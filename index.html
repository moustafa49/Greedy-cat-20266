<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ğŸ˜º Greedy Cat MAX</title>

<style>
body{
  background:#0f0f0f;
  color:#fff;
  font-family:Tahoma,Arial;
  text-align:center;
  margin:0;
}
h1{margin:10px 0}
.box{
  background:#1a1a1a;
  border-radius:14px;
  padding:12px;
  margin:10px auto;
  max-width:440px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
}
.item{
  font-size:26px;
  padding:10px;
  border-radius:12px;
  background:#222;
  cursor:pointer;
  user-select:none;
}
.item.hot{outline:2px solid orange}

/* ===== Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø±ØªØ¨ ===== */
.bar{
  display:flex;
  flex-direction:row-reverse;   /* Ø§Ù„Ø£Ø­Ø¯Ø« ÙŠÙ…ÙŠÙ† */
  gap:6px;
  overflow-x:auto;
  padding:6px;
}
.round{
  background:#1f1f1f;
  padding:4px 6px;
  border-radius:8px;
  font-size:15px;
  display:flex;
  align-items:center;
  gap:4px;
  cursor:pointer;
  white-space:nowrap;
}
.num{
  font-size:9px;
  color:#777;
}

button{
  padding:8px 12px;
  border-radius:10px;
  border:none;
  margin:4px;
  cursor:pointer;
}
.active{background:#ffb300;color:#000}

.warn{color:#ff5252;font-weight:bold}
.ok{color:#4caf50}
.small{font-size:13px;opacity:.85}
.green{color:#4caf50}
.red{color:#ff5252}
</style>
</head>

<body>

<h1>ğŸ˜º Greedy Cat MAX</h1>

<div class="box">
<b>ÙˆØ¶Ø¹ Ø§Ù„ØªÙˆÙ‚Ø¹</b><br>
<button id="m32" class="active" onclick="setMode('32')">3 Ø®Ø¶Ø§Ø± + 2 Ù„Ø­ÙˆÙ…</button>
<button id="m31" onclick="setMode('31')">3 Ø®Ø¶Ø§Ø± + 1 Ù„Ø­Ù…Ø©</button>
<button id="m21" onclick="setMode('21')">2 Ø®Ø¶Ø§Ø± + 1 Ù„Ø­Ù…Ø©</button>
<button id="m33" onclick="setMode('33')">3 Ø®Ø¶Ø§Ø± + 3 Ù„Ø­ÙˆÙ…</button>
</div>

<div class="box">
<b>Ø§Ù„Ø£ØµÙ†Ø§Ù</b>
<div class="grid" id="items"></div>
<div class="small">Ø¶ØºØ· = ØªØ³Ø¬ÙŠÙ„ | Ø¶ØºØ· Ù…Ø·ÙˆÙ‘Ù„ = HOT ğŸ”¥</div>
</div>

<div class="box">
<b>Ø¢Ø®Ø± 20 Ø¯ÙˆØ± (Ø§Ù„Ø£Ø­Ø¯Ø« ÙŠÙ…ÙŠÙ†)</b>
<div class="bar" id="bar"></div>
</div>

<div class="box">
<b>Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„ØºØ§ÙŠØ¨Ø©</b>
<div id="missing" class="small"></div>
</div>

<div class="box">
<b>âš ï¸ ØªØ­Ø°ÙŠØ± Ø§Ù„ØªÙƒØ±Ø§Ø±</b>
<div id="warning"></div>
</div>

<div class="box">
<b>ğŸ”® Ø§Ù„ØªÙˆÙ‚Ø¹ + %</b>
<div id="prediction"></div>
</div>

<button onclick="resetAll()">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>

<script>
const veggies=["ğŸ¥•","ğŸŒ½","ğŸ…","ğŸŒ¶ï¸"];
const meats=["ğŸ”","ğŸŸ","ğŸ¦","ğŸ—"];
const all=[...veggies,...meats];

let history=[];
let hot={};
let mode="32";

const itemsDiv=document.getElementById("items");
const barDiv=document.getElementById("bar");
const missingDiv=document.getElementById("missing");
const warningDiv=document.getElementById("warning");
const predictionDiv=document.getElementById("prediction");

/* Ø±Ø³Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
all.forEach(i=>{
  const d=document.createElement("div");
  d.className="item";
  d.textContent=i;
  let t;
  d.onclick=()=>{ history.push(i); render(); };
  d.onmousedown=()=>{ t=setTimeout(()=>{ hot[i]=!hot[i]; render(); },600); };
  d.onmouseup=()=>clearTimeout(t);
  itemsDiv.appendChild(d);
});

/* Ø£ÙˆØ¶Ø§Ø¹ */
function setMode(m){
  mode=m;
  ["m32","m31","m21","m33"].forEach(id=>document.getElementById(id).classList.remove("active"));
  document.getElementById("m"+m).classList.add("active");
  render();
}

/* Ù…Ù†Ø¹ 3 ÙˆØ±Ø§ Ø¨Ø¹Ø¶ */
function blocked(i){
  const l=history.slice(-2);
  return l.length===2 && l[0]===i && l[1]===i;
}

/* ØªØ­Ø°ÙŠØ± ØªÙƒØ±Ø§Ø± */
function repeatWarning(){
  const last5=history.slice(-5);
  let w=[];
  all.forEach(i=>{
    if(last5.filter(x=>x===i).length>=3)
      w.push(`${i} ØªÙƒØ±Ø§Ø± Ø¹Ø§Ù„ÙŠ`);
  });
  return w;
}

/* Ø³ÙƒÙ‘ÙˆØ± */
function score(i){
  if(blocked(i)) return -999;
  const last=history.lastIndexOf(i);
  const miss= last===-1 ? 20 : history.length-last-1;
  const missW=Math.min(miss,10);
  const hotW=hot[i]?2:0;
  return missW+hotW;
}

function render(){
  /* Ø¥Ø¨Ø±Ø§Ø² HOT */
  document.querySelectorAll(".item").forEach(d=>{
    d.classList.toggle("hot",hot[d.textContent]);
  });

  /* ===== Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø±ØªØ¨ + Ø§Ù„Ù…Ø±Ù‚Ù… ===== */
  barDiv.innerHTML="";
  const start=Math.max(0,history.length-20);
  history.slice(-20).forEach((item,idx)=>{
    const wrap=document.createElement("div");
    wrap.className="round";
    const realIndex=start+idx;

    wrap.onclick=()=>{
      history.splice(realIndex,1);
      render();
    };

    const num=document.createElement("span");
    num.className="num";
    num.textContent=realIndex+1;

    const icon=document.createElement("span");
    icon.textContent=item;

    wrap.appendChild(num);
    wrap.appendChild(icon);
    barDiv.appendChild(wrap);
  });

  /* Ø§Ù„ØºÙŠØ§Ø¨ */
  missingDiv.innerHTML="";
  all.forEach(i=>{
    const last=history.lastIndexOf(i);
    if(last!==-1){
      const gap=history.length-last-1;
      if(gap>=5) missingDiv.innerHTML+=`${i} ØºØ§ÙŠØ¨ ${gap} Ø¯ÙˆØ±<br>`;
    }
  });

  /* ØªØ­Ø°ÙŠØ± */
  const w=repeatWarning();
  warningDiv.innerHTML=w.length
    ? `<span class="warn">${w.join(" | ")}</span>`
    : `<span class="ok">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø®Ø·Ø± ÙˆØ§Ø¶Ø­</span>`;

  /* Ø§Ù„ØªÙˆÙ‚Ø¹ */
  const ranked=all.map(i=>({i,s:score(i)})).sort((a,b)=>b.s-a.s);
  let needV=0, needM=0;
  if(mode==="32"){needV=3;needM=2}
  if(mode==="31"){needV=3;needM=1}
  if(mode==="21"){needV=2;needM=1}
  if(mode==="33"){needV=3;needM=3}

  const pickV=ranked.filter(x=>veggies.includes(x.i)).slice(0,needV);
  const pickM=ranked.filter(x=>meats.includes(x.i)).slice(0,needM);
  const picks=[...pickV,...pickM];

  const sum=picks.reduce((a,b)=>a+Math.max(b.s,0),0)||1;
  predictionDiv.innerHTML=picks.map(p=>{
    const cls=veggies.includes(p.i)?"green":"red";
    return `<span class="${cls}">${p.i} ${(p.s/sum*100).toFixed(1)}%</span>`;
  }).join(" ");
}

function resetAll(){
  history=[];hot={};render();
}

render();
</script>

</body>
</html>
