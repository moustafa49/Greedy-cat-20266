<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ± Greedy Cat MAX</title>

<style>
body{
  background:#0f0f0f;
  color:#fff;
  font-family:Tahoma,Arial;
  direction:rtl;
  text-align:center;
  margin:0;
}
h1{margin:10px 0}
.card{
  background:#1a1a1a;
  margin:10px auto;
  padding:12px;
  border-radius:14px;
  max-width:420px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:8px;
}
.btn{
  background:#2a2a2a;
  border-radius:12px;
  padding:10px 0;
  font-size:22px;
  cursor:pointer;
  user-select:none;
}
.btn.hot{outline:2px solid orange}
.small{font-size:13px;color:#aaa}
.mode{
  padding:6px 10px;
  border-radius:10px;
  background:#333;
  margin:4px;
  cursor:pointer;
}
.mode.active{background:#ff9800;color:#000}
.bar{
  display:flex;
  overflow-x:auto;
  gap:6px;
  font-size:22px;
}
.bar span{
  background:#333;
  padding:6px;
  border-radius:8px;
  cursor:pointer;
}
.warn{color:#ff5252}
.ok{color:#4caf50}
.percent{font-size:14px}
button{
  padding:8px 16px;
  border-radius:10px;
  border:none;
  font-size:15px;
  cursor:pointer;
}
</style>
</head>

<body>

<h1>ğŸ± Greedy Cat MAX</h1>

<div class="card">
  <div>ÙˆØ¶Ø¹ Ø§Ù„ØªÙˆÙ‚Ø¹</div>
  <div>
    <span class="mode active" onclick="setMode('3v2')">3 Ø®Ø¶Ø§Ø± + 2 Ù„Ø­ÙˆÙ…</span>
    <span class="mode" onclick="setMode('3v1')">3 Ø®Ø¶Ø§Ø± + 1 Ù„Ø­Ù…Ø©</span>
    <span class="mode" onclick="setMode('2v1')">2 Ø®Ø¶Ø§Ø± + 1 Ù„Ø­Ù…Ø©</span>
    <span class="mode" onclick="setMode('3v3')">3 Ø®Ø¶Ø§Ø± + 3 Ù„Ø­ÙˆÙ…</span>
  </div>
</div>

<div class="card">
  <div class="grid" id="items"></div>
  <div class="small">Ø¶ØºØ· = ØªØ³Ø¬ÙŠÙ„ | Ø¶ØºØ· Ù…Ø·ÙˆÙ‘Ù„ = HOT ğŸ”¥</div>
</div>

<div class="card">
  <div>ğŸ“œ Ø¢Ø®Ø± 20 Ø¯ÙˆØ± (Ø§Ø¶ØºØ· Ù„Ù„Ø­Ø°Ù)</div>
  <div class="bar" id="history"></div>
</div>

<div class="card">
  <div>ğŸ“Š Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„ØºØ§ÙŠØ¨Ø©</div>
  <div id="missing"></div>
</div>

<div class="card">
  <div>ğŸ§  Ø§Ù„ØªÙˆÙ‚Ø¹ Ø§Ù„Ø°ÙƒÙŠ (%)</div>
  <div id="predict"></div>
</div>

<button onclick="resetAll()">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>

<script>
const veg = ["ğŸŒ¶ï¸","ğŸ…","ğŸŒ½","ğŸ¥•"];
const meat = ["ğŸ—","ğŸ¦","ğŸŸ","ğŸ”"];
const all = [...veg,...meat];

let history = [];
let hot = {};
let mistakes = {};
let mode = "3v2";

const itemsDiv = document.getElementById("items");

all.forEach(i=>{
  const d=document.createElement("div");
  d.className="btn";
  d.innerText=i;
  let press;
  d.onmousedown=()=>press=setTimeout(()=>{
    hot[i]=!hot[i];
    render();
  },600);
  d.onmouseup=()=>{
    clearTimeout(press);
    add(i);
  };
  itemsDiv.appendChild(d);
});

function add(i){
  history.push(i);
  render();
}

function remove(idx){
  history.splice(idx,1);
  render();
}

function setMode(m){
  mode=m;
  document.querySelectorAll(".mode").forEach(x=>x.classList.remove("active"));
  event.target.classList.add("active");
  render();
}

function resetAll(){
  history=[];
  hot={};
  mistakes={};
  render();
}

function learnMistake(i){
  mistakes[i]=(mistakes[i]||0)+1;
}

function score(i){
  const last=history.lastIndexOf(i);
  const miss= last==-1 ? 20 : history.length-last-1;
  const hotW=hot[i]?3:0;
  const penalty=(mistakes[i]||0)*3;
  return miss+hotW-penalty;
}

function predict(){
  let v=[...veg].sort((a,b)=>score(b)-score(a));
  let m=[...meat].sort((a,b)=>score(b)-score(a));

  let pick=[];
  if(mode=="3v2") pick=[...v.slice(0,3),...m.slice(0,2)];
  if(mode=="3v1") pick=[...v.slice(0,3),m[0]];
  if(mode=="2v1") pick=[...v.slice(0,2),m[0]];
  if(mode=="3v3") pick=[...v.slice(0,3),...m.slice(0,3)];

  const total=pick.reduce((s,i)=>s+Math.max(score(i),1),0);
  return pick.map(i=>`${i} ${(score(i)/total*100).toFixed(1)}%`).join(" ");
}

function render(){
  // items
  document.querySelectorAll(".btn").forEach(b=>{
    b.classList.toggle("hot",hot[b.innerText]);
  });

  // history
  const h=document.getElementById("history");
  h.innerHTML="";
  history.slice(-20).forEach((i,idx)=>{
    const s=document.createElement("span");
    s.innerText=i;
    s.onclick=()=>remove(idx);
    h.appendChild(s);
  });

  // missing
  const miss=document.getElementById("missing");
  miss.innerHTML=all.map(i=>{
    const last=history.lastIndexOf(i);
    const m= last==-1?history.length:history.length-last-1;
    return `${i} ØºØ§ÙŠØ¨ ${m} Ø¯ÙˆØ±`;
  }).join("<br>");

  // detect repeat mistake
  if(history.length>=2){
    const a=history[history.length-1];
    const b=history[history.length-2];
    if(a==b) learnMistake(a);
  }

  document.getElementById("predict").innerHTML=predict();
}

render();
</script>

</body>
</html>
